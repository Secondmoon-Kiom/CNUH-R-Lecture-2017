---
title: \textbf{\LARGE R을 이용한 자료처리 및 시각화}
subtitle: \textbf{\Large 기본 환경 설정부터 재현가능한 연구 방법 입문}\vspace{2cm}\linebreak 한국한의학연구원 한의기반연구부\linebreak Korea Institute of Oriental Medicine, KM Fundamental Research Division \vspace{2cm} 
author: \textbf{\Large 구본초, Ph.D. in Statistics}
date: "2017-11-23"
output: 
  bookdown::pdf_book:
    includes: 
      in_header: preamble.tex
    toc: true 
    toc_depth: 2
    highlight: tango
    fig_caption: yes
    citation_package: natbib
    keep_tex: yes
documentclass: book
classoption: a4paper
link-citation: yes
colorlinkgs: yes
lot: no
lof: no
fontsize: 12pt
urlcolor: blue
bibliography: CNUH.bib

---


```{r knitr_init, echo=FALSE, results="hide", message=FALSE, cache=FALSE}
 
knitr::opts_knit$set(root.dir = '..') 
options(max.print = 5000)
knitr::opts_chunk$set(eval = TRUE, echo = FALSE, cache = FALSE, include = TRUE, collapse = FALSE, tidy=TRUE, message=FALSE, warning=FALSE,
                    dependson = NULL, engine = "R", error = TRUE, fig.path="Figures/", fig.align = "center", fig.width = 7, fig.height = 7,
                     fig.keep='all', fig.retina=2, background = '#F7F7F7', highlight = T, comment = NA, tidy = TRUE, tidy.opts=list(blank=FALSE, width.cutoff=50))
```

# R을 사용하기 위한 환경 설정

## Overview

### What is R?

- R 언어: 통계 및 자료 시각화를 지원하는 언어 및 환경

- 1980년 AT\&T 연구소의 John Chambers가 개발한 S 언어를 기반으로 1995년 뉴질랜드 Auckland Univ.의 Robert Gentleman \& Ross Ihaka 개발이 그 기원임

- GNU 기반 오픈소스

### Why R? 

1. 장점
    - \textbf{Free software}
    - 주요 운영체제(Unix, Windows, Macintosh)에서 사용 가능
    - 현존하는 거의 대부분의 통계 방법론들이 package로 구현
    - 강력한 그래픽 기능
    - 빠른 update 및 연산속도(?)
    - 방대한 community 및 R package에 공개 및 공유된 자료

2. Do we have to learn R language?
    - 물론 꼭 배울 필요는 없다!! (요리를 하는데 꼭 좋은 칼이 필요 없듯이...)
    - 다양한 통계 소프트웨어 및 분석 언어(SPSS, SAS, WEKA, MATLAB, PYTHON, ...) 존재
    - 프로그래밍에 익숙하지 않은 사용자들의 접근성이 떨어짐
    - 하지만 배워두면 좋은 이유
        - 통계분석과 보고서 작성을 위한 최적 환경
            - R + Rstudio + Rmarkdown을 통해 분석에서부터 보고서 작성까지 한번에 가능 
        - SPSS, SAS에 비해 확장성이 높기 때문에 다양한 문제에 적용 가능
        - 방대한 양의 메뉴얼 및 서적들
        - 그리고 이 모든 것을 거의 대부분 무료 사용 가능
      
\begin{quote}
\colorbox{gray!10}{\begin{minipage}{15cm}
\textbf{Tips}
  \begin{itemize}
    \item R에서 구현한 모든 package들은 CRAN (The Comprehensive R Archive Network, http://cran.r-project.org/web/view)에서 살펴볼 수 있음
    \item R과 관련한 대부분의 문제는 Google 검색과 스텍 오버플로우(http://stackoverflow.com)에서 해결할 수 있음
    \item 본 문서는 서민구 선생님의 ``R을 이용한 데이터 처리 \& 실무'' \citep{Seo-2014} 와 고석범 선생님의 ``R과 Knitr을 활용한 데이터 연동형 문서 만들기'' \citep{Ko-2014} 의 내용을 주로 참조함. 
  \end{itemize}
\end{minipage}}
\end{quote}

\newpage

## R 설치하기(Windows 용)

R은 공개 소프트웨어로 http://www.r-project.org/ 에서 다운로드 및 설치 가능

1. 웹브라우저(i.e. explore, chrome, firefox 등)에서 http://www.r-project.org 이동
2. 좌측 R Logo 하단 Download 아래 `CRAN' 클릭

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 12cm, height = 12cm]{Figures/Rorg-main-add.png}
  \caption[www.r-project.org 메인화면]{www.r-project.org 메인화면}\label{fig:R-install-01}
}
\end{figure}

3. 클릭 후 연결 창에서 스크롤 후 ``Korea'' 아래 링크 클릭 (그림 \ref{fig:R-install-02} 참조)

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 12cm, height = 8cm]{Figures/CRAN-korea-01.PNG}
  \caption[CRAN 국가별 mirrors]{CRAN 국가별 mirrors}\label{fig:R-install-02}
}
\end{figure}

4. 클릭 후 세 가지 운영체제(Linux, Mac OS X, Windowns)에 따른 R 버전 선택 가능
    - 본 문서에서는 Windows 버전 설치만 다룸

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 12cm, height = 10cm]{Figures/Rinstall-01.png}
  \caption[운영체제 별 R 버전 선택]{운영체제 별 R 버전 선택}\label{fig:R-install-03}
}
\end{figure} 

5. ``Downloads R for Windows'' 링크 클릭하면 다음과 같은 화면으로 이동

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 12cm, height = 10cm]{Figures/Rinstall-02.png}
  \caption[Windows 용 R base 및 구성요소 다운로드]{Windows 용 R base 및 구성요소 다운로드}\label{fig:R-install-04}
}
\end{figure} 

6. R을 구성하는 하위구조 중 "base" 링크 클릭 후 다음 화면에서 "Downloads R 3.4.2 for Windows"를 클릭 후 설치 파일을 임의의 디렉토리에 저장 후 실행(그림 \ref{fig:R-install-05} 참조)

7. 참고로 3개 subdirectories에 대한 간략한 설명은 아래와 같음
    - `base`: R 실행 프로그램 
    - `contrib`: R package의 바이너리 파일 
    - `Rtools`: R package 개발 및 배포를 위한 프로그램

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 12cm, height = 10cm]{Figures/Rinstall-03.png}
  \caption[Windows 용 R 설치 파일 다운로드 페이지]{Windows 용 R 설치 파일 다운로드 페이지}\label{fig:R-install-05}
}
\end{figure} 

8. 다운로드한 파일을 실행하면 아래와 같은 대화창이 나타남
    - 한국어 선택 $\rightarrow$ 환영 화면에서 [다음(N)>] 클릭

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 14cm, height = 11cm]{Figures/R-install-F01.png}
  \caption[R 설치과정 01]{R 설치과정 01}\label{fig:R-install-06}
}
\end{figure} 

9. GNU 라이센스에 대한 설명 및 동의 여부([다음(N)>]) 클릭 (그림 \ref{fig:R-install-07})

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 8cm, height = 8cm]{Figures/R-install-F02.png}
  \caption[R GNU general license]{R GNU general license}\label{fig:R-install-07}
}
\end{figure} 

10. 설치 디렉토리 설정 및 구성요소 설지 여부
    - 원하는 디렉토리 설정(예: `C:\R\R-3.4.2`) (그림 \ref{fig:R-install-08})
    - 기본 프로그램("Core Files"), 32 또는 64 bit 용 설치 파일, R console 한글 번역 모두 체크 뒤 [다음(N)>] 클릭 (그림 \ref{fig:R-install-09})
    
\begin{figure}[H]
{
  \centering
  \includegraphics[width = 15cm, height = 10cm]{Figures/R-install-F03.png}
  \caption[R 설치 디렉토리 설정]{R 설치 디렉토리 설정}\label{fig:R-install-08}
}
\end{figure}     

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 8cm, height = 8cm]{Figures/R-install-F04.png}
  \caption[R 구성요소 설치]{R 구성요소 설치}\label{fig:R-install-09}
}
\end{figure}

11. R 스타트업 옵션 지정
    - 기본값("No" check-button)으로도 설치 진행 가능
    - 본 문서에서는 스타트업 옵션 변경으로 진행

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 8cm, height = 8cm]{Figures/R-install-F05.png}
  \caption[R 스타트업 옵션 변경]{R 스타트업 옵션 변경}\label{fig:R-install-10}
}
\end{figure}


12. 화면표시방식(디스플레이 모드) 설정 변경
    - MDI: 한 윈도우 내에서 script 편집창, 출력, 도움말 창 사용
    - SDI: 다중 창에서 각각 script 편집창, 출력, 도움말 등을 독립적으로 열기
    
\begin{figure}[H]
{
  \centering
  \includegraphics[width = 8cm, height = 8cm]{Figures/R-install-F06.png}
  \caption[R 화면표시방식 설정 변경]{R 화면표시방식 설정 변경}\label{fig:R-install-11}
}
\end{figure}

13. 도움말 형식에서 HTML 도움말 기반 선택

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 8cm, height = 8cm]{Figures/R-install-F07.png}
  \caption[R 도움말 형식 변경]{R 도움말 형식 변경}\label{fig:R-install-12}
}
\end{figure}

14. 시작메뉴 폴더 선택(그림 \ref{fig:R-install-13})
    - "바로가기"를 생성할 시작 메뉴 폴더 지정 후 [다음(N)>] 클릭 후 설치 진행
    - 하단 "시작메뉴 폴더 만들지 않음" 체크박스 표시 시 시작메뉴에  "바로가기" 생성되지 않음(실행에 전혀 지장 없음)

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 8cm, height = 8cm]{Figures/R-install-F08.png}
  \caption[시작메뉴 폴더 선택]{시작메뉴 폴더 선택}\label{fig:R-install-13}
}
\end{figure}

15. 추가 옵션 지정: 바탕화면 아이콘 생성 등 추가적 작업 옵션 체크 후 [다음(N)>] 클릭 $\rightarrow$ 설치 진행
    - 설치된 R 버전 정보 레지스트리 저장 여부 
    - `.Rdata` 확장자를 R 실행파일과 자동 연계

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 8cm, height = 8cm]{Figures/R-install-F09.png}
  \caption[R 추가옵션 사항 선택]{R 추가옵션 사항 선택}\label{fig:R-install-14}
}
\end{figure}

16. 설치 완료 후 바탕화면의 R 아이콘을 더블클릭하면 Rgui가 실행

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 15cm, height = 10cm]{Figures/Rgui.png}
  \caption[Windows에서 R 실행화면(SDI)]{Windows에서 R 실행화면(콘솔 창, SDI 모드)}\label{fig:R-install-15}
}
\end{figure}

## R 시작 및 작동 체크

위 R 시작화면에서 간단한 명령어들을 체크

- 그림 \ref{fig:R-install-15}에서 `>` 기호는 R의 명령 프롬프트임. 
- Checklist
    1) "Hello R" 출력
    2) 1부터 100까지 정수 출력
    3) 간단한 histogram 출력
    
```{r check-01, echo = TRUE, prompt = TRUE}
# 문자열 출력
print("Hello R")
```

여기서 `#` 기호는 주석의 시작을 의미하며 같은 행에서 `#` 뒤 내용의 코드는 실행되지 않음

```{r check-02, echo = T, prompt = T}
# 1부터 100까지 수열 출력
seq(1:100) # print("Hello R")
```

```{r check-03, echo = T, prompt = T, out.width="10 cm", out.height="10 cm"}
# 간단한 히스토그램
set.seed(12345) # random seed 지정
x <- rnorm(1000) # 평균 0, 분산 1인 정규분포에서 난수 1000개 생성
hist(x) # 히스토그램
```

\begin{quote}
\colorbox{gray!10}{\begin{minipage}{15cm}
\textbf{Tips}

R 명령어 실행 시 간혹 아니 매우 빈번히 오류가 나타나는데, 이를 해결할 수 있는 가장 손쉬운 방법은 Googling과 R의 도움말을 이용하는 것이 가장 효율적임. 
\end{minipage}}
\end{quote}

도움말을 볼 수 있은 R 함수 리스트

\begin{table}[H]
  \centering
  \begingroup\footnotesize
  \caption{R help 관련 명령어 리스트}
  \begin{tabular}{p{3cm}p{5cm}p{7cm}}
  \toprule
  \textbf{도움말 보기 명령어} & \textbf{설명} & \textbf{사용법} \\
  \midrule
  \texttt{help} 또는 \texttt{?}          & 도움말 시스템 호출               & \texttt{help(topic \textit{\# 도움말을 찾고자 하는 대상 또는 함수}) }\\
  \texttt{help.search} 또는 \texttt{??}  & 주어진 문자열을 포함한 문서 검색 & \texttt{help.search(pattern \textit{\# 찾고자 하는 문자열})} \\ 
  \texttt{example}                       & topic의 도움말 페이지에 있는 examples section 실행 & \texttt{example(topic \textit{\# 예제를 실행하고자 하는 topic 또는 함수})} \\
  \texttt{vignette}                      & topic의 pdf 또는 html 레퍼런스 메뉴얼 불러오기 & \texttt{vignette(topic \textit{\# topic에 저장된 reference manual})} \\
  \bottomrule
  \end{tabular}
  \endgroup
\end{table}

### 이것으로 R 설치 완료??

- 기본적 R 사용방식은 입력한 명령어와 실행결과를 확인하는 대화형(interpreter) 방식
- R 기본 콘솔창 안에서도 \keystroke{TAB}을 누르면 자동완성 기능이라던가 \keystroke{$\uparrow$}, \keystroke{$\downarrow$}를 누르면 이전/이후 명령 기록을 볼 수 있음.
- 여러 줄 이상의 R 명령어라든가 반복적, 장기간 작업을 수행해야 하는 경우라면 R 명령어로 구성된 스크립트 작성 후 일괄 실행하는 것이 일반적임. 
- 이러한 다중 명령 코딩 시 콘솔창에 직접 입력하는 것은 비효율적 $\rightarrow$ 스크립트 에디터를 주로 사용
- R 자체적으로 기본적인 스크립트 에디터 제공(R editor) $\rightarrow$ 가독성 및 코딩 효율이 떨어짐
- 대표적 R 에디터: WinEdt (http://www.winedt.com), Tinn-R (https://sourceforge.net/projects/tinn-r/), Vim (http://www.vim.org/scripts/script.php?script_id=2628)
- 대부분의 분석 및 개발 환경이 RGUI 만으로 구성되어 있지 않음 $\rightarrow$ \textbf{RStudio}를 이용한 통합 분석 환경 설정 

\newpage

## RStudio 설치하기

- Rstudio: R 통합 분석/개발 환경(integrated development environment, IDE)으로 현재 가장 대중적으로 사용되고 있는 R 사용 환경
- 명령 콘솔 외 파일 편집, 데이터 보기, 명령 기록(`.history`), 그래프 등에 쉽게 접근 가능
- R과 마찬가지로 무료 소프트웨어임 

1. Rstudio 사이트 접속
    - 웹 브라우저를 통해 https://www.rstudio.com 연결 후 메인 화면에서 "Download Rstudio" 클릭
    - 혹은 상단 Pop-up manu 중 Products $\rightarrow$ RStudio 클릭 후 연결된 화면에서 다운로드 진행

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 13cm, height = 13cm]{Figures/Rstudio-main.png}
  \caption[RStudio 메인 페이지]{RStudio 메인 페이지 화면}\label{fig:Rstudio-install-01}
}
\end{figure}  

2. Desktop 또는 Sever 버전 중 택일
    - 서버용 설치를 위해서는 Server 클릭 $\rightarrow$ 소규모 자료 분석용으로는 불필요
    - 여기서는 "Desktop" 버전 선택 후 다음 링크로 이동

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 12cm, height = 10cm]{Figures/Rstudio-download.png}
  \caption[RStudio 다운로드 페이지]{RStudio 다운로드 페이지}\label{fig:Rstudio-install-02}
}
\end{figure}  

3. 운영체제에 맞는 Rstudio installer 다운로드(여기서는 Windows 버전 다운로드)

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 12cm, height = 10cm]{Figures/Rstudio-download-02.png}
  \caption[RStudio 운영체제 선택]{RStudio 운영체제 선택}\label{fig:Rstudio-install-03}
}
\end{figure}  

4. RStudio installer 다운로드 시 파일이 저장된 폴더에서 보통 `RStudio-xx.xx.xxx.exe` 형식의 파일명 확인
    - 더블 클릭 후 실행
    - \keystroke{다음>} 몇 번 누르면 설치 종료
    
\begin{figure}[H]
{
  \centering
  \includegraphics[width = 15cm, height = 12cm]{Figures/Rstudio-installer.png}
  \caption[RStudio 설치화면]{RStudio 설치화면}\label{fig:Rstudio-install-04}
}
\end{figure}  

5. 아래와 같은 실행화면이 나타나면 RStudio 설치 성공

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 15cm, height = 13cm]{Figures/Rstudio-init.png}
  \caption[RStudio 초기 실행화면]{RStudio 초기 실행화면}\label{fig:Rstudio-install-05}
}
\end{figure}  

## RStudio의 화면구성

1. RStudio IDE 화면 구성

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 12cm, height = 10cm]{Figures/Rstudio-cap1.png}
  \caption[RStudio 화면구성]{RStudio 화면구성}\label{fig:Rstudio-part-01}
}
\end{figure}  

2. 창 순서는 사용자의 편의에 따라 변경 가능
    - 상단 메뉴바에서 \keystroke{Tools} $\rightarrow$ \keystroke{Global Options} $\rightarrow$ \keystroke{Pane Layout}에서 조정

\begin{figure}[H]
{
  \centering
  \includegraphics[width = 12cm, height = 10cm]{Figures/Rstudio-layout.png}
  \caption[RStudio Global Options: Pane layout]{RStudio Global Options에서 화면 레이아웃 조정}\label{fig:Rstudio-layout}
}
\end{figure}  


# R의 기본 사용

## 변수

## 스칼라 

## 벡터

## 리스트

## 행렬

## 배열

## 데이터 프레임


# 데이터 조작

## 파일 입출력




# References 
